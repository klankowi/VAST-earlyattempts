limits = c(bbox[2], bbox[4])) +
ggspatial::annotation_scale(location = 'br')
sel.plot
wgs_bbox
sel.surv <- survey.names[i]
sel.pts <- subset(surveys, SURVEY == sel.surv)
bbox <- st_bbox(sel.pts)
wgs_bbox <-  st_bbox(
st_transform(
st_as_sfc(bbox),
"EPSG:4326"
)
)
wgs_bbox[c(1,2)] <- round(wgs_bbox)[c(1,2)]
wgs_bbox[c(3,4)] <- round(wgs_bbox)[c(3,4)]
bbox <- st_bbox(
st_transform(
st_as_sfc(wgs_bbox),
"EPSG:26919"
)
)
# Call labels
lab.use <- new.labs[[survey.names[i]]]
# Plot
sel.plot <- ggplot() +
geom_sf(data = s1[s1$atl.tif <=0,],
aes(fill = as.factor(depthgroup), col = as.factor(depthgroup))) +
scale_fill_manual(values =  dcol) +
scale_color_manual(values = dcol) +
geom_sf(data=sel.pts, pch=19, cex=1, col=alpha('black', 0.2)) +
geom_sf(data = index_area_shapes, col='white', fill=NA, lwd=2) +
geom_sf(data=us_states_sf,
fill='gray', color='darkgray') +
geom_label(data = lab.use,
aes(x = X, y = Y, label = Stock), fill = "white",
size = 3) +
xlab(" ") +
ylab(" ") +
coord_sf(xlim=c(bbox[1], bbox[3]),
ylim=c(bbox[2], bbox[4]),
crs = "EPSG:26919") +
scale_x_continuous(expand = c(0,0),
limits = c(bbox[1], bbox[3])) +
scale_y_continuous(expand = c(0,0),
limits = c(bbox[2], bbox[4])) +
ggspatial::annotation_scale(location = 'br')
sel.plot
wgs_bbox
wgs_bbox[c(1,2,3,4)] <- c(-71.9, 41, -71.0, 41.8)
bbox <- st_bbox(
st_transform(
st_as_sfc(wgs_bbox),
"EPSG:26919"
)
)
# Call labels
lab.use <- new.labs[[survey.names[i]]]
bbox
lab.use
333843.3 -256090.9
256090.9 + (77752.4 / 2)
# Call labels
lab.use <- new.labs[[survey.names[i]]]
lab.use[1,'X'] <- 294967
lab.use[1,'Y'] <- 4545000
lab.use
# Plot
sel.plot <- ggplot() +
geom_sf(data = s1[s1$atl.tif <=0,],
aes(fill = as.factor(depthgroup), col = as.factor(depthgroup))) +
scale_fill_manual(values =  dcol) +
scale_color_manual(values = dcol) +
geom_sf(data=sel.pts, pch=19, cex=1, col=alpha('black', 0.2)) +
geom_sf(data = index_area_shapes, col='white', fill=NA, lwd=2) +
geom_sf(data=us_states_sf,
fill='gray', color='darkgray') +
geom_label(data = lab.use,
aes(x = X, y = Y, label = Stock), fill = "white",
size = 3) +
xlab(" ") +
ylab(" ") +
coord_sf(xlim=c(bbox[1], bbox[3]),
ylim=c(bbox[2], bbox[4]),
crs = "EPSG:26919") +
scale_x_continuous(expand = c(0,0),
limits = c(bbox[1], bbox[3])) +
scale_y_continuous(expand = c(0,0),
limits = c(bbox[2], bbox[4])) +
ggspatial::annotation_scale(location = 'br')
sel.plot
# Set GGplot auto theme
theme_set(theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_rect(fill = "#DEF5E5", color = NA),
#panel.background = element_rect(fill = "navy", color = NA),
panel.border = element_rect(color='black', size=1, fill=NA),
#legend.position = "bottom",
axis.text.x=element_text(size=20),
axis.text.y=element_text(size=20),
axis.title.x=element_text(size=24),
axis.title.y=element_text(size=24, angle=90, vjust=2),
plot.title=element_text(size=24, hjust = 0, vjust = 1.2),
plot.caption=element_text(hjust=0, face='italic', size=12),
legend.position = "n"))
# Plot
sel.plot <- ggplot() +
geom_sf(data = s1[s1$atl.tif <=0,],
aes(fill = as.factor(depthgroup), col = as.factor(depthgroup))) +
scale_fill_manual(values =  dcol) +
scale_color_manual(values = dcol) +
geom_sf(data=sel.pts, pch=19, cex=1, col=alpha('black', 0.2)) +
geom_sf(data = index_area_shapes, col='white', fill=NA, lwd=2) +
geom_sf(data=us_states_sf,
fill='gray', color='darkgray') +
geom_label(data = lab.use,
aes(x = X, y = Y, label = Stock), fill = "white",
size = 5) +
xlab(" ") +
ylab(" ") +
coord_sf(xlim=c(bbox[1], bbox[3]),
ylim=c(bbox[2], bbox[4]),
crs = "EPSG:26919") +
scale_x_continuous(expand = c(0,0),
limits = c(bbox[1], bbox[3])) +
scale_y_continuous(expand = c(0,0),
limits = c(bbox[2], bbox[4])) +
ggspatial::annotation_scale(location = 'br')
survey.names[i]
ggsave(paste0("C:/Users/klankowicz/Desktop/", survey.names[i], "_closeup.png"),
plot = sel.plot)
# Clear workspace
rm(list=ls())
#### Load libraries ####
library(tidyverse, quietly=T,verbose=F)
library(readxl, quietly=T,verbose=F)
library(reshape2, quietly=T, verbose=F)
library(ggh4x, quietly=T, verbose=F)
library(zoo, quietly=T, verbose=F)
library(RColorBrewer, quietly=T, verbose=F)
library(gridExtra, quietly=T, verbose=F)
# Set seed for reproducibility
set.seed(123)
# Add function
scaleFUN <- function(x) sprintf("%.1f", x)
# Set GGplot auto theme
theme_set(theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
legend.position = "n",
axis.text.x=element_text(size=18),
axis.text.y=element_text(size=18),
axis.title.x=element_text(size=20),
axis.title.y=element_text(size=20, angle=90, vjust=2),
legend.text=element_text(size=16),
plot.title=element_text(size=18, hjust = 0, vjust = 1.2),
strip.text.x = element_text(size = 16)))
#### Load data ####
# Read in index data
indd <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"Index_Data.csv"))
# Remove extra DFO series
indd <- subset(indd, AREA != "5Z1-2")
indd <- subset(indd, AREA != "5ZJ-M")
# Create naming conventions
indd$STOCKSEASON <- paste(indd$STOCK,indd$SEASON)
# Load in length-frequency data
lenfq <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"LenFreq_Data.csv"))
lenfq <- subset(lenfq, AREA !='5Z1-2')
lenfq <- subset(lenfq, AREA !='5ZJ-M')
lenfq$STOCKSEASON <- paste(lenfq$STOCK,lenfq$SEASON)
# Load in numbers-at-age data
numage <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"NumAge_Data.csv"))
numage <- subset(numage, AREA !='5Z1-2')
numage <- subset(numage, AREA !='5ZJ-M')
numage$STOCKSEASON <- paste(numage$STOCK,numage$SEASON)
# Load in survey data
survd <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"Survey_Data.csv"))
survd <- subset(survd, AREA !='5Z1-2')
# Load in metadata
metad <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"Metadata.csv"))
metad <- subset(metad, INDEX_NAME !='DFO_5Z1-2_SUMMER_A0+')
metad <- subset(metad, INDEX_NAME !='DFO_5ZJ-M_SPRING_A0+')
# Set seasonal color palettes
# Spring <- c("#96AD9F", "#3A836E", "#4D6116")
# Summer <- c("#884090", "#643187", "#0A1567")
# Fall <- c("#FDBB84", "#EF3B2C", "#67000D")
# Winter <- c("#B3CEE5", "#0476D0", "#4B0082")
Spring <- "#3A836E"
Summer <- "#643187"
Fall <- "#EF3B2C"
Winter <- "#0476D0"
f=1
survo <- unique(lenfq$SURVEY)[f]
survo.sub <- subset(lenfq, SURVEY == paste0(survo))
survo.list <- split(survo.sub, f=survo.sub$AREA)
length(survo.list)
survo
nrows <- ceiling(length(table(survo.list[[i]]$YEAR))/4)
i
i=1
nrows <- ceiling(length(table(survo.list[[i]]$YEAR))/4)
ncols <- 4
nrows
ncol
survo <- unique(lenfq$SURVEY)[f]
survo.sub <- subset(lenfq, SURVEY == paste0(survo))
ind.split <- split(survo.sub, f=survo.sub$AREA)
nrows <- ceiling(length(table(ind.split[[i]]$YEAR))/4)
ncols <- 4
if(nrows<=6){
maxfreq <- plyr::round_any(max(ind.split[[i]]$FREQUENCY), 0.5, ceiling)
lenfreq1 <- ggplot(data=ind.split[[i]],
aes(x=LENGTH, y=FREQUENCY)) +
geom_col(fill="black",color="black") +
# scale_y_continuous(name="Frequency",
# expand=expansion(mult=c(0,0.05))) +
scale_x_continuous(name="Length (cm)") +
theme(plot.title=element_text(size=18),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
plot.caption=element_text(hjust=0, face='italic', size=12),
strip.text.x=element_text(size=14),
axis.title.x=element_text(size=16),
axis.title.y=element_text(size=16),
axis.text.x=element_text(size=12, angle=65, hjust=1),
axis.text.y=element_text(size=12),
panel.spacing=unit(0.5,"lines")) +
labs(x="Length (cm)",
y="Frequency",
title=paste(survo,
ind.split[[i]]$STOCK[1],
ind.split[[i]]$SEASON[1]),
caption='Length-frequency reported as proportion of catch per 2cm bin') +
facet_wrap2(vars(ind.split[[i]]$YEAR), ncol = ncols,
nrow = nrows) +
force_panelsizes(rows=unit(rep(1.25, ncols), "in"),
col=unit(rep(1.25, nrows), "in"), TRUE)+
ylim(0,maxfreq)
plot(lenfreq1)
}
nrows<=6
nrows
<
# Length Freq plots
survo <-  'NEFSC BTS'
survo2 <- 'NEFSC_BTS'
ind.split <- subset(lenfq, SURVEY==paste0(survo2))
ind.split <- subset(lenfq, SURVEY==paste0(survo))
table(ind.split$INDEX_NAME)
ind.split <- split(ind.split, f=ind.split$INDEX_NAME)
i
nrows <- ceiling(length(table(ind.split[[i]]$YEAR))/4)
ncols <- 4
if(nrows > 10){
ind.split_s <- ind.split
maxfreq <- plyr::round_any(max(ind.split[[i]]$FREQUENCY), 5, ceiling)
yrs <- unique(ind.split[[i]]$YEAR)
yrlen <- length(yrs)
multtimes <- ceiling(length(yrs)/20)
coll1 <- subset(ind.split[[i]],
YEAR >= yrs[1]&
YEAR <= yrs[20])
coll2 <- subset(ind.split[[i]],
YEAR >= yrs[21]&
YEAR <= yrs[40])
coll3 <- subset(ind.split[[i]],
YEAR >= yrs[41]&
YEAR <= max(YEAR))
lenfreq1 <- ggplot(data=coll1,
aes(x=LENGTH, y=FREQUENCY)) +
geom_col(fill="black",color="black") +
# scale_y_continuous(name="Frequency",
# expand=expansion(mult=c(0,0.05))) +
scale_x_continuous(name="Length (cm)") +
theme(plot.title=element_text(size=22),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
plot.caption=element_text(hjust=0, face='italic', size=12),
strip.text.x=element_text(size=18),
axis.title.x=element_text(size=20),
axis.title.y=element_text(size=20),
axis.text.x=element_text(size=16, angle=65, hjust=1),
axis.text.y=element_text(size=16),
panel.spacing=unit(0.5,"lines")) +
labs(x="Length (cm)",
y="Frequency",
title=paste(survo,
coll1$STOCK[1],
coll1$SEASON[1]),
caption='Length-frequency reported as raw catch per 1cm bin') +
facet_wrap2(vars(coll1$YEAR), ncol = ncols,
nrow = 5) +
#force_panelsizes(#rows=unit(rep(1, 5), "in"),
#                col=unit(rep(1.25, ncols), "in"), TRUE) +
ylim(0,maxfreq)
plot(lenfreq1)
rm(lenfreq1, coll1)
cat("\n\\newpage\n")
# Next sequence
lenfreq2 <- ggplot(data=coll2,
aes(x=LENGTH, y=FREQUENCY)) +
geom_col(fill="black",color="black") +
# scale_y_continuous(name="Frequency",
# expand=expansion(mult=c(0,0.05))) +
scale_x_continuous(name="Length (cm)") +
theme(plot.title=element_text(size=22),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
plot.caption=element_text(hjust=0, face='italic', size=12),
strip.text.x=element_text(size=18),
axis.title.x=element_text(size=20),
axis.title.y=element_text(size=20),
axis.text.x=element_text(size=16, angle=65, hjust=1),
axis.text.y=element_text(size=16),
panel.spacing=unit(0.5,"lines")) +
labs(x="Length (cm)",
y="Frequency",
title=paste(survo,
coll2$STOCK[1],
coll2$SEASON[1]),
caption='Length-frequency reported as raw catch per 1cm bin') +
facet_wrap2(vars(coll2$YEAR), ncol = ncols,
nrow = 5) +
#force_panelsizes(#rows=unit(rep(1, 5), "in"),
#                col=unit(rep(1.25, ncols), "in"), TRUE) +
ylim(0,maxfreq)
plot(lenfreq2)
rm(lenfreq2, coll2)
cat("\n\\newpage\n")
# Next sequence
lenfreq3 <- ggplot(data=coll3,
aes(x=LENGTH, y=FREQUENCY)) +
geom_col(fill="black",color="black") +
# scale_y_continuous(name="Frequency",
# expand=expansion(mult=c(0,0.05))) +
scale_x_continuous(name="Length (cm)") +
theme(plot.title=element_text(size=22),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
plot.caption=element_text(hjust=0, face='italic', size=12),
strip.text.x=element_text(size=18),
axis.title.x=element_text(size=20),
axis.title.y=element_text(size=20),
axis.text.x=element_text(size=16, angle=65, hjust=1),
axis.text.y=element_text(size=16),
panel.spacing=unit(0.5,"lines")) +
labs(x="Length (cm)",
y="Frequency",
title=paste(survo,
coll3$STOCK[1],
coll3$SEASON[1]),
caption='Length-frequency reported as raw catch per 1cm bin') +
facet_wrap2(vars(coll3$YEAR), ncol = ncols,
nrow = 5) +
force_panelsizes(rows=unit(rep(1.5, 5), "in"),
col=unit(rep(1.65, ncols), "in"), TRUE) +
ylim(0,maxfreq)
plot(lenfreq3)
rm(lenfreq1, coll3)
cat("\n\\newpage\n")
}
rm(ind.split, ind.split_s, lenfreq3, survo.list, survo.sub)
rm(f, i, maxfreq, multtimes)
rm(survo, ncols, nrows)
rm(survo2, yrlen)
rm(yrs)
#### Length Freq plots ####
# Set GGplot auto theme
theme_set(theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
legend.position = "n",
axis.text.x=element_text(size=22),
axis.text.y=element_text(size=22),
axis.title.x=element_text(size=24),
axis.title.y=element_text(size=24, angle=90, vjust=2),
legend.text=element_text(size=16),
plot.title=element_text(size=22, hjust = 0, vjust = 1.2),
strip.text.x = element_text(size = 22)))
f=1
survo <- unique(lenfq$SURVEY)[f]
survo.sub <- subset(lenfq, SURVEY == paste0(survo))
ind.split <- split(survo.sub, f=survo.sub$AREA)
names(ind.split)
i
i=1
# Clear workspace
rm(list=ls())
#### Load libraries ####
library(tidyverse, quietly=T,verbose=F)
library(readxl, quietly=T,verbose=F)
library(reshape2, quietly=T, verbose=F)
library(ggh4x, quietly=T, verbose=F)
library(zoo, quietly=T, verbose=F)
library(RColorBrewer, quietly=T, verbose=F)
library(gridExtra, quietly=T, verbose=F)
# Set seed for reproducibility
set.seed(123)
# Add function
scaleFUN <- function(x) sprintf("%.1f", x)
# Set GGplot auto theme
theme_set(theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
legend.position = "n",
axis.text.x=element_text(size=18),
axis.text.y=element_text(size=18),
axis.title.x=element_text(size=20),
axis.title.y=element_text(size=20, angle=90, vjust=2),
legend.text=element_text(size=16),
plot.title=element_text(size=18, hjust = 0, vjust = 1.2),
strip.text.x = element_text(size = 16)))
#### Load data ####
# Read in index data
indd <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"Index_Data.csv"))
# Remove extra DFO series
indd <- subset(indd, AREA != "5Z1-2")
indd <- subset(indd, AREA != "5ZJ-M")
#indd$INDEX_NAME[indd$INDEX_NAME =='5Z1-7'] <- 'GBK'
# Create naming conventions
indd$STOCKSEASON <- paste(indd$STOCK,indd$SEASON)
# Load in length-frequency data
lenfq <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"LenFreq_Data.csv"))
lenfq <- subset(lenfq, AREA !='5Z1-2')
lenfq <- subset(lenfq, AREA !='5ZJ-M')
lenfq$STOCKSEASON <- paste(lenfq$STOCK,lenfq$SEASON)
# Load in numbers-at-age data
numage <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"NumAge_Data.csv"))
numage <- subset(numage, AREA !='5Z1-2')
numage <- subset(numage, AREA !='5ZJ-M')
numage$STOCKSEASON <- paste(numage$STOCK,numage$SEASON)
# Load in survey data
survd <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"Survey_Data.csv"))
# Clear workspace
rm(list=ls())
#### Load libraries ####
library(tidyverse, quietly=T,verbose=F)
library(readxl, quietly=T,verbose=F)
library(reshape2, quietly=T, verbose=F)
library(ggh4x, quietly=T, verbose=F)
library(zoo, quietly=T, verbose=F)
library(RColorBrewer, quietly=T, verbose=F)
library(gridExtra, quietly=T, verbose=F)
# Set seed for reproducibility
set.seed(123)
# Add function
scaleFUN <- function(x) sprintf("%.1f", x)
# Set GGplot auto theme
theme_set(theme(panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.background = element_blank(),
axis.line = element_line(colour = "black"),
legend.position = "n",
axis.text.x=element_text(size=18),
axis.text.y=element_text(size=18),
axis.title.x=element_text(size=20),
axis.title.y=element_text(size=20, angle=90, vjust=2),
legend.text=element_text(size=16),
plot.title=element_text(size=18, hjust = 0, vjust = 1.2),
strip.text.x = element_text(size = 16)))
#### Load data ####
# Read in index data
indd <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"Index_Data.csv"))
# Remove extra DFO series
indd <- subset(indd, AREA != "5Z1-2")
indd <- subset(indd, AREA != "5ZJ-M")
#indd$INDEX_NAME[indd$INDEX_NAME =='5Z1-7'] <- 'GBK'
# Create naming conventions
indd$STOCKSEASON <- paste(indd$STOCK,indd$SEASON)
# Load in length-frequency data
lenfq <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"LenFreq_Data.csv"))
lenfq <- subset(lenfq, AREA !='5Z1-2')
lenfq <- subset(lenfq, AREA !='5ZJ-M')
lenfq$STOCKSEASON <- paste(lenfq$STOCK,lenfq$SEASON)
# Load in numbers-at-age data
numage <- read.csv(paste0("C:/Users/klankowicz/Box/Katie Lankowicz/",
"Groundfish_Survey_Data_Mods/Collated_Data2/",
"NumAge_Data.csv"))
numage <- subset(numage, AREA !='5Z1-2')
numage <- subset(numage, AREA !='5ZJ-M')
